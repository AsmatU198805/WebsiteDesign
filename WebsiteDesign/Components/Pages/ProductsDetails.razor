@page "/ProductDetails/{ProductId:int}"
@rendermode InteractiveServer

@using WebsiteDesign.Models
@inject HttpClient Http
@inject NavigationManager Nav

<h3 class="mb-4">Product Details</h3>

@if (loading)
{
    <p>Loading product...</p>
}
else if (product == null)
{
    <div class="alert alert-danger">
        Product not found
    </div>
}
else
{
    <div class="card" style="max-width: 520px;">
        <img src="/images/@product.ImageUrl"
             class="card-img-top img-fluid"
             alt="@product.ProductName" />

        <div class="card-body">
            <h5 class="card-title">@product.ProductName</h5>

            <p class="text-muted">
                <b>Category:</b> @product.ProductCategory
            </p>

            <p class="fw-bold fs-5">
                Price: @product.Price
            </p>

            <p>
                @product.Description
            </p>

            <button class="btn btn-secondary mt-3"
                    @onclick="GoBack">
                Back to Products
            </button>
        </div>
    </div>
}

@code {

    [Parameter]
    public int ProductId { get; set; }

    Product? product;
    bool loading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // API endpoint: api/Products/{ProductId}
            product = await Http.GetFromJsonAsync<Product>(
                $"http://localhost:5138/api/Products/{ProductId}");
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
            product = null;
        }
        finally
        {
            loading = false;
        }
    }

    void GoBack()
    {
        Nav.NavigateTo("/Products");
    }
}
